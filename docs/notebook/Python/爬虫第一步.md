---
title: ğŸ•·ï¸ã€çˆ¬è™«ç¬¬ä¸€æ­¥ã€ğŸ•·ï¸
---


## çˆ¬è™«ç¬¬ä¸€æ­¥

### 1.å¼€å¤´
å¼€å¤´å†™
```py
# coding=utf-8
```
### 2.å¼•å…¥æ¨¡å—
```py
from bs4 import BeautifulSoup
import urllib.request,urllib.error
import re
import xlwt
import sqlite3
```

### 3.åˆ†å·¥åˆä½œ
å®šä¹‰å¥½å„ä¸ªå‡½æ•°çš„åŠŸèƒ½ï¼Œåˆ†å·¥åˆä½œ

```py
#å‰é¢å†™1.å¼€å¤´ 2.å¼•å…¥æ¨¡å—... 

if __name__ == "__main__":
    main()
    print("çˆ¬å–å¹¶ä¿å­˜å®Œæ¯•ï¼")

# 1.ä¸»ç¨‹åº å…¥å£ å¼€å§‹ï¼
def main():
    baseurl = "https://m.ithome.com/" 
    datalist = getData(baseurl)
    savepath = ('.\\ITä¹‹å®¶æœ€æ–°æ–°é—».xls')
    saveData(datalist,savepath)


# 2. ã€re-æ­£åˆ™è¡¨è¾¾å¼ã€‘ ï¼ˆç­›é€‰è§„åˆ™ï¼‰
findLink = re.compile(r'<a href="(.*?)" role="option" target="_blank">')
#...

# 3. ã€bsè§£æ reç­›é€‰ã€‘ æ•´ç†æ•°æ®
def getData(baseurl):
    datalist = []
    html = askURL(baseurl)
    soup = BeautifulSoup(html,"html.parser")
    #æ¥åˆ°è¿™å°±ä»£è¡¨ å·²ç»çˆ¬å–åˆ°äº†ä¿¡æ¯
    
    #ä¸‹é¢è¿™æ˜¯æŠŠçˆ¬å–åˆ°çš„å†…å®¹è¿›è¡Œç­›é€‰ ï¼ˆåˆ©ç”¨æ­£åˆ™ï¼‰
    for item in soup.find_all('div',class_="placeholder one-img-plc"):
        data = []
        item = str(item)

        link = re.findall(findLink,item)[0]
        #çˆ¬å–è¯¦æƒ…
        details = detailsURL(link)
        details_soup = BeautifulSoup(details,"html.parser")
        news = details_soup.find_all('div',"news-content")[0]
        news = str(news)
        # print(news)

        #æ–°é—»æ—¶é—´
        item_time = details_soup.find_all('span',"news-time")
        item_time = str(item_time)
        news_time = re.findall(find_news_time,item_time)
        if not bool(news_time):
            # print("è¿™ä¸ªæ˜¯itä¹‹å®¶æ”¶é›†åˆ«äººçš„æ–°é—»")
            item_time = details_soup.find_all('span',"post-time")[0]
            item_time = str(item_time)
            news_time = re.findall(find_post_time,item_time)[0]
        else:
            news_time = re.findall(find_news_time,item_time)[0]
        # print(news_time)
        imgSrc = re.findall(findImgSrc,item)[0]

        title = re.findall(findTitle,item)[0]

        #ç»è¿‡ç½‘é¡µè§‚å¯Ÿ æ²¡æ—¶é—´çš„å°±æ˜¯å¹¿å‘Š
        time = re.findall(findTime,item)[0]

        if bool(time):
            # print("è¿™ä¸ªä¸æ˜¯å¹¿å‘Š")
            data.append(link)
            data.append(imgSrc)
            data.append(title)
            data.append(time)
            data.append(news_time)
            data.append(news)
            datalist.append(data)
        else: 
            print("è¿™ä¸ªæ˜¯å¹¿å‘Š")

    print("è¿”å›çˆ¬å–å¹¶ç­›é€‰å¥½çš„æ•°æ®åˆ—è¡¨")
    return datalist

# 4.ã€çˆ¬ã€‘urllib å¼€å§‹çˆ¬å–æ•°æ®
def askURL(baseurl):
    # å†™è¯·æ±‚å¤´è¿›è¡Œ ä¼ªè£…
    head = {
        "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.90 Safari/537.36 Edg/89.0.774.54"
    }
    request = urllib.request.Request(baseurl,headers=head)
    html = ''
    try:
        response = urllib.request.urlopen(request)
        html = response.read().decode('utf-8')
        # print(html)
    except urllib.error.URLError as e:
        if hasattr(e,"code"):
            print(e.code)
        if hasattr(e,"reason"):
            print(e.reason)

    return html

# 4.ã€çˆ¬ã€‘urllib çˆ¬å–è¯¦æƒ…é“¾æ¥é‡Œé¢çš„å†…å®¹
def detailsURL(link):
    # å†™è¯·æ±‚å¤´è¿›è¡Œ ä¼ªè£…
    head = {
        "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.90 Safari/537.36 Edg/89.0.774.54"
    }
    request = urllib.request.Request(link,headers=head)
    details = ''
    try:
        response = urllib.request.urlopen(request)
        details = response.read().decode('utf-8')
    except urllib.error.URLError as e:
        if hasattr(e,"code"):
            print(e.code)
        if hasattr(e,"reason"):
            print(e.reason)

    return details

#5.ã€ä¿å­˜ã€‘æŠŠçˆ¬å–åˆ° å¹¶ä¸”ç­›é€‰å¥½çš„æ•°æ® ä¿å­˜èµ·æ¥
def saveData(datalist,savepath):
    print('å¼€å§‹ä¿å­˜...')
    book = xlwt.Workbook(encoding='utf-8')
    sheet = book.add_sheet('ITæ–°é—»',cell_overwrite_ok=True)
    col = ("åŸé“¾æ¥","å›¾ç‰‡é“¾æ¥","æ–°é—»æ ‡é¢˜","æ—¶é—´","è¯¦æƒ…æ—¶é—´","å†…å®¹html")
    for i in range(0,6):
        sheet.write(0,i,col[i])
    for i in range(len(datalist)):
        print("ç¬¬%dæ¡" %(i+1))
        data = datalist[i]
        for j in range(0,6):
            sheet.write(i+1,j,data[j])
    
    book.save(savepath)
```


